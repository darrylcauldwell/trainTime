# GitHub Secrets Setup for LiveRail

## Security Model

LiveRail uses a **default embedded API token** with optional user override:
- Default token is obfuscated in `trainTime/Config.swift`
- Users can optionally enter their own token in Settings
- CI/CD can inject tokens at build time via environment variables

## For Local Development

The token is already embedded in `Config.swift`. Just build and run.

## For GitHub Actions / CI/CD

### 1. Add Secret to GitHub Repository

1. Go to your repository → **Settings** → **Secrets and variables** → **Actions**
2. Click **New repository secret**
3. Name: `DARWIN_API_TOKEN`
4. Value: `0ca3d009-ddb1-4f12-975e-59f0a737a8f7` (or your token)
5. Click **Add secret**

### 2. Use in GitHub Actions Workflow

```yaml
name: Build LiveRail

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Build
        env:
          DARWIN_API_TOKEN: ${{ secrets.DARWIN_API_TOKEN }}
        run: |
          xcodebuild -project trainTime.xcodeproj \
                     -scheme trainTime \
                     -destination 'platform=iOS Simulator,name=iPhone 17 Pro' \
                     build
```

### 3. Use in Fastlane

Add to `fastlane/Fastfile`:

```ruby
lane :release do
  # Token is injected via environment variable
  api_token = ENV['DARWIN_API_TOKEN']
  
  build_app(
    scheme: "trainTime",
    export_method: "app-store"
  )
  
  upload_to_app_store
end
```

Run with:
```bash
DARWIN_API_TOKEN="${{ secrets.DARWIN_API_TOKEN }}" bundle exec fastlane release
```

## Security Notes

✅ **Safe to commit**: `Config.swift` (token is obfuscated)
✅ **Safe to commit**: GitHub Actions workflows (use `${{ secrets.X }}`)
❌ **Never commit**: Raw token strings
❌ **Never commit**: `.env` files with tokens

## How It Works

1. **Build time**: GitHub Actions sets `DARWIN_API_TOKEN` environment variable
2. **Runtime**: `Config.swift` checks `ProcessInfo.processInfo.environment["DARWIN_API_TOKEN"]`
3. **Fallback**: If not set, uses embedded obfuscated token
4. **User override**: Settings allows users to enter their own token

This ensures:
- ✅ App works out of the box (embedded token)
- ✅ CI/CD can use GitHub Secrets (environment variable)
- ✅ Users can override if needed (Settings)
- ✅ Token never exposed in plaintext in repository
